<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_65) on Mon Nov 10 11:34:50 PST 2014 -->
<TITLE>
IpMeter
</TITLE>

<META NAME="date" CONTENT="2014-11-10">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="IpMeter";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/IpMeter.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-files/index-1.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../org/phoenixbioinformatics/proxy/cache/InternetAddress.html" title="class in org.phoenixbioinformatics.proxy.cache"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.STATUS.html" title="enum in org.phoenixbioinformatics.proxy.cache"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html?org/phoenixbioinformatics/proxy/cache/IpMeter.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="IpMeter.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;<A HREF="#nested_class_summary">NESTED</A>&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
org.phoenixbioinformatics.proxy.cache</FONT>
<BR>
Class IpMeter</H2>
<PRE>
java.lang.Object
  <IMG SRC="../../../../resources/inherit.gif" ALT="extended by "><B>org.phoenixbioinformatics.proxy.cache.IpMeter</B>
</PRE>
<HR>
<DL>
<DT><PRE>public class <B>IpMeter</B><DT>extends java.lang.Object</DL>
</PRE>

<P>
<p>
 Handles the checking ond insertion/updating of meter information in the
 database.
 </p>
 <p>
 Metering is the ability to access paid content without logging in or being
 subscribed up to a certain number of accesses per period.
 </p>
<P>

<P>
<DL>
<DT><B>Author:</B></DT>
  <DD>Robert J. Muller</DD>
</DL>
<HR>

<P>
<!-- ======== NESTED CLASS SUMMARY ======== -->

<A NAME="nested_class_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Nested Class Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;class</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.STATUS.html" title="enum in org.phoenixbioinformatics.proxy.cache">IpMeter.STATUS</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Possible statuses for IP address given current count</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private &nbsp;class</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.UpdateThread.html" title="class in org.phoenixbioinformatics.proxy.cache">IpMeter.UpdateThread</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
</TABLE>
&nbsp;<!-- =========== FIELD SUMMARY =========== -->

<A NAME="field_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Field Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;java.util.Map&lt;java.lang.String,java.lang.Integer&gt;</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#cachedCounts">cachedCounts</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the cache of counts keyed on IP address</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;java.util.List&lt;org.phoenixbioinformatics.paywall.bs.paywall.BsIpMeterCount&gt;</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#counts">counts</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array of counts to update</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;org.phoenixbioinformatics.paywall.bs.paywall.IpMeterCountDelegate</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#delegate">delegate</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The data access delegate</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;java.util.Queue&lt;java.lang.String&gt;</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#insertQueue">insertQueue</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the insert queue for new meter counts</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;<A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html" title="class in org.phoenixbioinformatics.proxy.cache">IpMeter</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#instance">instance</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the singleton instance of the meter</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#jndi">jndi</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Whether to get a JNDI delegate or a JDBC delegate</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;org.apache.log4j.Logger</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#logger">logger</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger for this class</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#processing">processing</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whether the updater is processing inserts and updates</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#running">running</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whether the meter is running, used in testing</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#SUBSCRIBE_COUNT">SUBSCRIBE_COUNT</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count at which to refuse proxying and prompt to subscribe</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;java.lang.String</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#SUBSYSTEM">SUBSYSTEM</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subsystem name in database.properties file</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;java.util.Queue&lt;java.lang.String&gt;</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#updateQueue">updateQueue</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the update queue for existing meter counts</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;<A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.UpdateThread.html" title="class in org.phoenixbioinformatics.proxy.cache">IpMeter.UpdateThread</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#updater">updater</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the asynchronous thread that updates to the database</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#WARN_COUNT">WARN_COUNT</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count at which to start warning to subscribe</TD>
</TR>
</TABLE>
&nbsp;
<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#IpMeter()">IpMeter</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#cache()">cache</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache all the IP Meter Counts from the database, clearing any database
 caches or local caches.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#clearCaches()">clearCaches</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Helper method to clear internal caches for any objects used in building the
 cache</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;<A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.STATUS.html" title="enum in org.phoenixbioinformatics.proxy.cache">IpMeter.STATUS</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#getAndIncrementMeterStatus(java.lang.String)">getAndIncrementMeterStatus</A></B>(java.lang.String&nbsp;ip)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get the meter status: OK meaning OK to proxy, WARN meaning warn to
 subscribe soon, or SUBSCRIBE meaning don't proxy, ask to subscribe.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;<A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html" title="class in org.phoenixbioinformatics.proxy.cache">IpMeter</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#getInstance()">getInstance</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get the singleton instance of the IP Meter.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>private static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#incrementAndUpdateCount(java.lang.String, java.lang.Integer)">incrementAndUpdateCount</A></B>(java.lang.String&nbsp;ip,
                        java.lang.Integer&nbsp;count)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Increment the meter count.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#interrupt()">interrupt</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Interrupt the updater thread to shut it down, and destroy the instance.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#isProcessing()">isProcessing</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Is the updater processing inserts and updates?</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#isRunning()">isRunning</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Is the meter running?</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html#setJndi(boolean)">setJndi</A></B>(boolean&nbsp;jndi)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Specify whether to use JNDI or JDBC.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class java.lang.Object</B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->

<A NAME="field_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Field Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="logger"><!-- --></A><H3>
logger</H3>
<PRE>
private static final org.apache.log4j.Logger <B>logger</B></PRE>
<DL>
<DD>logger for this class
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="instance"><!-- --></A><H3>
instance</H3>
<PRE>
private static <A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html" title="class in org.phoenixbioinformatics.proxy.cache">IpMeter</A> <B>instance</B></PRE>
<DL>
<DD>the singleton instance of the meter
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="running"><!-- --></A><H3>
running</H3>
<PRE>
private static boolean <B>running</B></PRE>
<DL>
<DD>whether the meter is running, used in testing
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="cachedCounts"><!-- --></A><H3>
cachedCounts</H3>
<PRE>
private static java.util.Map&lt;java.lang.String,java.lang.Integer&gt; <B>cachedCounts</B></PRE>
<DL>
<DD>the cache of counts keyed on IP address
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="insertQueue"><!-- --></A><H3>
insertQueue</H3>
<PRE>
private static java.util.Queue&lt;java.lang.String&gt; <B>insertQueue</B></PRE>
<DL>
<DD>the insert queue for new meter counts
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="updateQueue"><!-- --></A><H3>
updateQueue</H3>
<PRE>
private static java.util.Queue&lt;java.lang.String&gt; <B>updateQueue</B></PRE>
<DL>
<DD>the update queue for existing meter counts
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="updater"><!-- --></A><H3>
updater</H3>
<PRE>
private static <A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.UpdateThread.html" title="class in org.phoenixbioinformatics.proxy.cache">IpMeter.UpdateThread</A> <B>updater</B></PRE>
<DL>
<DD>the asynchronous thread that updates to the database
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="counts"><!-- --></A><H3>
counts</H3>
<PRE>
private static final java.util.List&lt;org.phoenixbioinformatics.paywall.bs.paywall.BsIpMeterCount&gt; <B>counts</B></PRE>
<DL>
<DD>array of counts to update
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="delegate"><!-- --></A><H3>
delegate</H3>
<PRE>
private static org.phoenixbioinformatics.paywall.bs.paywall.IpMeterCountDelegate <B>delegate</B></PRE>
<DL>
<DD>The data access delegate
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="jndi"><!-- --></A><H3>
jndi</H3>
<PRE>
private static boolean <B>jndi</B></PRE>
<DL>
<DD>Whether to get a JNDI delegate or a JDBC delegate
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="processing"><!-- --></A><H3>
processing</H3>
<PRE>
private static boolean <B>processing</B></PRE>
<DL>
<DD>whether the updater is processing inserts and updates
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="WARN_COUNT"><!-- --></A><H3>
WARN_COUNT</H3>
<PRE>
private static final int <B>WARN_COUNT</B></PRE>
<DL>
<DD>count at which to start warning to subscribe
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../../../constant-values.html#org.phoenixbioinformatics.proxy.cache.IpMeter.WARN_COUNT">Constant Field Values</A></DL>
</DL>
<HR>

<A NAME="SUBSCRIBE_COUNT"><!-- --></A><H3>
SUBSCRIBE_COUNT</H3>
<PRE>
private static final int <B>SUBSCRIBE_COUNT</B></PRE>
<DL>
<DD>count at which to refuse proxying and prompt to subscribe
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../../../constant-values.html#org.phoenixbioinformatics.proxy.cache.IpMeter.SUBSCRIBE_COUNT">Constant Field Values</A></DL>
</DL>
<HR>

<A NAME="SUBSYSTEM"><!-- --></A><H3>
SUBSYSTEM</H3>
<PRE>
private static final java.lang.String <B>SUBSYSTEM</B></PRE>
<DL>
<DD>Subsystem name in database.properties file
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../../../constant-values.html#org.phoenixbioinformatics.proxy.cache.IpMeter.SUBSYSTEM">Constant Field Values</A></DL>
</DL>

<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="IpMeter()"><!-- --></A><H3>
IpMeter</H3>
<PRE>
public <B>IpMeter</B>()</PRE>
<DL>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="getInstance()"><!-- --></A><H3>
getInstance</H3>
<PRE>
public static <A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.html" title="class in org.phoenixbioinformatics.proxy.cache">IpMeter</A> <B>getInstance</B>()</PRE>
<DL>
<DD>Get the singleton instance of the IP Meter. If the meter is not yet
 running, this method creates it along with the queue and updater thread,
 then starts the thread running. Getting the instance does not cache the
 IP meter counts, call the cache() method to do that.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>the singleton IP Meter</DL>
</DD>
</DL>
<HR>

<A NAME="cache()"><!-- --></A><H3>
cache</H3>
<PRE>
public static void <B>cache</B>()</PRE>
<DL>
<DD>Cache all the IP Meter Counts from the database, clearing any database
 caches or local caches.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="clearCaches()"><!-- --></A><H3>
clearCaches</H3>
<PRE>
private static void <B>clearCaches</B>()</PRE>
<DL>
<DD>Helper method to clear internal caches for any objects used in building the
 cache
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="interrupt()"><!-- --></A><H3>
interrupt</H3>
<PRE>
public static void <B>interrupt</B>()</PRE>
<DL>
<DD>Interrupt the updater thread to shut it down, and destroy the instance.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="getAndIncrementMeterStatus(java.lang.String)"><!-- --></A><H3>
getAndIncrementMeterStatus</H3>
<PRE>
public static <A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.STATUS.html" title="enum in org.phoenixbioinformatics.proxy.cache">IpMeter.STATUS</A> <B>getAndIncrementMeterStatus</B>(java.lang.String&nbsp;ip)</PRE>
<DL>
<DD>Get the meter status: OK meaning OK to proxy, WARN meaning warn to
 subscribe soon, or SUBSCRIBE meaning don't proxy, ask to subscribe. Getting
 the status also increments the count, so execute this only once.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>ip</CODE> - the IP address to check
<DT><B>Returns:</B><DD>the meter status</DL>
</DD>
</DL>
<HR>

<A NAME="incrementAndUpdateCount(java.lang.String, java.lang.Integer)"><!-- --></A><H3>
incrementAndUpdateCount</H3>
<PRE>
private static void <B>incrementAndUpdateCount</B>(java.lang.String&nbsp;ip,
                                            java.lang.Integer&nbsp;count)</PRE>
<DL>
<DD>Increment the meter count. If this is an update,
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>ip</CODE> - the IP address to count<DD><CODE>count</CODE> - the meter count</DL>
</DD>
</DL>
<HR>

<A NAME="isRunning()"><!-- --></A><H3>
isRunning</H3>
<PRE>
public static boolean <B>isRunning</B>()</PRE>
<DL>
<DD>Is the meter running?
<P>
<DD><DL>

<DT><B>Returns:</B><DD>true if running, false if not</DL>
</DD>
</DL>
<HR>

<A NAME="isProcessing()"><!-- --></A><H3>
isProcessing</H3>
<PRE>
public static boolean <B>isProcessing</B>()</PRE>
<DL>
<DD>Is the updater processing inserts and updates?
<P>
<DD><DL>

<DT><B>Returns:</B><DD>true if processing, false if not</DL>
</DD>
</DL>
<HR>

<A NAME="setJndi(boolean)"><!-- --></A><H3>
setJndi</H3>
<PRE>
public static void <B>setJndi</B>(boolean&nbsp;jndi)</PRE>
<DL>
<DD>Specify whether to use JNDI or JDBC.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>jndi</CODE> - true to use JNDI, false to use JDBC</DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/IpMeter.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-files/index-1.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../org/phoenixbioinformatics/proxy/cache/InternetAddress.html" title="class in org.phoenixbioinformatics.proxy.cache"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../org/phoenixbioinformatics/proxy/cache/IpMeter.STATUS.html" title="enum in org.phoenixbioinformatics.proxy.cache"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html?org/phoenixbioinformatics/proxy/cache/IpMeter.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="IpMeter.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;<A HREF="#nested_class_summary">NESTED</A>&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
